<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Split-It | Login</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fluent.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="login-page-body">
    <!-- Intro Animation Overlay -->
    <div id="introOverlay" class="intro-overlay">
        <div class="intro-logo" id="introLogo">
            <span class="logo-split">Split</span>
            <span class="logo-hyphen">-</span>
            <span class="logo-it">It</span>
        </div>
    </div>

    <!-- Main Login Page Container -->
    <div class="login-page-container" id="loginContainer">
        <!-- Gradient Background Border -->
        <div class="login-gradient-bg"></div>

        <!-- Interactive Background Shapes (above gradient, below UI) -->
        <div class="interactive-bg" id="interactiveBg"></div>

        <!-- Split-It Title at Top -->
        <div class="login-title">
            <span class="title-split">Split</span><span class="title-hyphen">-</span><span class="title-it">It</span>
        </div>

        <!-- Dark Login Card -->
        <div class="login-card" id="loginCard">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert {{ category }} animate-fade-in-up">{{ message }}</div>
            {% endfor %}
            {% endif %}
            {% endwith %}

            <!-- Login Form -->
            <div class="login-form-section" id="loginForm">
                <h2>Welcome Back</h2>
                <form method="POST" action="/login" id="loginFormElement">
                    <div class="input-group">
                        <label>Email</label>
                        <input type="email" name="email" placeholder="Enter your email" required>
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" name="password" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn-primary ripple-effect" style="width: 100%;">Log In</button>
                </form>
                <p class="switch-text">New here? <a onclick="toggleForms()">Create Account</a></p>
            </div>

            <!-- Register Form -->
            <div class="login-form-section hidden" id="registerForm">
                <h2>Join the Squad</h2>
                <form method="POST" action="/login">
                    <input type="hidden" name="register_check" value="true">
                    <div class="input-group">
                        <label>Username</label>
                        <input type="text" name="username" placeholder="Choose a username" required>
                    </div>
                    <div class="input-group">
                        <label>Email</label>
                        <input type="email" name="email" placeholder="Enter your email" required>
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" name="password" placeholder="Create a password" required>
                    </div>
                    <button type="submit" class="btn-primary ripple-effect" style="width: 100%;">Sign Up</button>
                </form>
                <p class="switch-text">Already have an account? <a onclick="toggleForms()">Log In</a></p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // INTERACTIVE FLOATING SHAPES
        // ============================================

        class InteractiveBackground {
            constructor() {
                this.container = document.getElementById('interactiveBg');
                this.shapes = [];
                this.mouseX = window.innerWidth / 2;
                this.mouseY = window.innerHeight / 2;
                this.repelRadius = 150;
                this.repelStrength = 0.08;

                this.init();
                this.bindEvents();
                this.animate();
            }

            init() {
                // Create floating shapes
                const shapeCount = 25;
                const shapeTypes = ['circle', 'square', 'triangle'];

                for (let i = 0; i < shapeCount; i++) {
                    const shape = document.createElement('div');
                    const type = shapeTypes[Math.floor(Math.random() * shapeTypes.length)];
                    const size = 10 + Math.random() * 30;

                    shape.className = `floating-shape ${type}`;
                    shape.style.width = `${size}px`;
                    shape.style.height = `${size}px`;

                    // Random initial position
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight;

                    // Random color from gradient palette
                    const colors = [
                        'rgba(0, 212, 255, 0.4)',
                        'rgba(0, 153, 255, 0.4)',
                        'rgba(102, 51, 255, 0.4)',
                        'rgba(153, 51, 255, 0.4)',
                        'rgba(0, 102, 255, 0.4)'
                    ];
                    shape.style.background = colors[Math.floor(Math.random() * colors.length)];

                    this.container.appendChild(shape);

                    this.shapes.push({
                        element: shape,
                        x: x,
                        y: y,
                        originX: x,
                        originY: y,
                        vx: 0,
                        vy: 0,
                        size: size,
                        floatSpeed: 0.5 + Math.random() * 1,
                        floatOffset: Math.random() * Math.PI * 2
                    });
                }
            }

            bindEvents() {
                document.addEventListener('mousemove', (e) => {
                    this.mouseX = e.clientX;
                    this.mouseY = e.clientY;
                });
            }

            animate() {
                const time = Date.now() * 0.001;

                this.shapes.forEach((shape, index) => {
                    // Calculate distance from mouse
                    const dx = shape.x - this.mouseX;
                    const dy = shape.y - this.mouseY;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    // Repel from mouse
                    if (distance < this.repelRadius && distance > 0) {
                        const force = (this.repelRadius - distance) / this.repelRadius;
                        const angle = Math.atan2(dy, dx);
                        shape.vx += Math.cos(angle) * force * this.repelStrength * 5;
                        shape.vy += Math.sin(angle) * force * this.repelStrength * 5;
                    }

                    // Float back to origin with gentle oscillation
                    const floatX = Math.sin(time * shape.floatSpeed + shape.floatOffset) * 20;
                    const floatY = Math.cos(time * shape.floatSpeed * 0.7 + shape.floatOffset) * 20;

                    const targetX = shape.originX + floatX;
                    const targetY = shape.originY + floatY;

                    shape.vx += (targetX - shape.x) * 0.02;
                    shape.vy += (targetY - shape.y) * 0.02;

                    // Apply friction
                    shape.vx *= 0.92;
                    shape.vy *= 0.92;

                    // Update position
                    shape.x += shape.vx;
                    shape.y += shape.vy;

                    // Apply transform
                    shape.element.style.transform = `translate(${shape.x}px, ${shape.y}px)`;
                });

                requestAnimationFrame(() => this.animate());
            }
        }

        // ============================================
        // INTRO ANIMATION ORCHESTRATION
        // ============================================

        document.addEventListener('DOMContentLoaded', function () {
            const introOverlay = document.getElementById('introOverlay');
            const introLogo = document.getElementById('introLogo');
            const loginContainer = document.getElementById('loginContainer');
            const loginCard = document.getElementById('loginCard');
            const hyphen = document.querySelector('.logo-hyphen');

            // Initialize interactive background
            new InteractiveBackground();

            // Check if this is a return visit (skip intro on refresh/back)
            const hasSeenIntro = sessionStorage.getItem('splitit_intro_seen');

            if (hasSeenIntro) {
                // Skip intro animation
                introOverlay.classList.add('intro-complete');
                loginContainer.classList.add('show-content');
                return;
            }

            // Mark intro as seen for this session
            sessionStorage.setItem('splitit_intro_seen', 'true');

            // Animation Timeline
            // Phase 1: Logo flies in from bottom (starts immediately)
            setTimeout(() => {
                introLogo.classList.add('fly-in');
            }, 100);

            // Phase 2: Hyphen pops in (after logo centers)
            setTimeout(() => {
                hyphen.classList.add('pop-in');
            }, 1000);

            // Phase 3: Logo flies to top center
            setTimeout(() => {
                introLogo.classList.add('fly-up');
            }, 1600);

            // Phase 4: Overlay starts rounding corners
            setTimeout(() => {
                introOverlay.classList.add('rounding');
            }, 2000);

            // Phase 5: Overlay shrinks to card shape
            setTimeout(() => {
                introOverlay.classList.add('shrink-to-card');
            }, 2200);

            // Phase 6: Show login content
            setTimeout(() => {
                loginContainer.classList.add('show-content');
            }, 2600);

            // Phase 7: Complete - hide overlay
            setTimeout(() => {
                introOverlay.classList.add('intro-complete');
            }, 3200);
        });

        // ============================================
        // FORM TOGGLE
        // ============================================

        function toggleForms() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');

            // Add exit animation
            const currentForm = loginForm.classList.contains('hidden') ? registerForm : loginForm;
            const nextForm = loginForm.classList.contains('hidden') ? loginForm : registerForm;

            currentForm.style.animation = 'none';
            currentForm.classList.add('hidden');

            nextForm.classList.remove('hidden');
            nextForm.style.animation = 'formSlideIn 0.3s cubic-bezier(0.1, 0.9, 0.2, 1) forwards';
        }
    </script>
</body>

</html>